{"version":3,"file":"index.js","mappings":"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","sources":["webpack://smartmeter-mbus-dlms/./src/lib/Telegram.ts","webpack://smartmeter-mbus-dlms/./src/lib/enums.ts","webpack://smartmeter-mbus-dlms/./src/lib/telegram-reader.ts","webpack://smartmeter-mbus-dlms/external commonjs \"serialport\"","webpack://smartmeter-mbus-dlms/webpack/bootstrap","webpack://smartmeter-mbus-dlms/./src/smartmeter-mbus-dlms.ts"],"sourcesContent":["// data link layer data\r\nexport class Telegram {\r\n\t// public possibleStartFound: boolean = false;\r\n\t// public startFound: boolean = false;\r\n\t// public stopFound: boolean = false;\r\n\r\n\tprivate _dataLen: number = 0;\r\n\tprivate _totalLen: number = 0;\r\n\r\n\tpublic set dataLen(len: number) {\r\n\t\tthis._dataLen = len;\r\n\t\tthis._totalLen = len! + 6; // 2x start, 2x len, checksum, stop\r\n\t}\r\n\tpublic get dataLen(): number {\r\n\t\treturn this._dataLen\r\n\t}\r\n\tpublic get totalLen(): number {\r\n\t\treturn this._totalLen\r\n\t}\r\n\r\n\tpublic checkSum: number = -1;\r\n\tpublic controlField: number = 0;\r\n\tpublic addressField: number = 0;\r\n\r\n\tprivate _controlInformationField: number = 0;\r\n\tprivate _sequenceNumber: number = 0;\r\n\tprivate _lastIsLastSegment: boolean = true; // or application data is only in one single telegram\r\n\r\n\tpublic set controlInformationField(ciField: number) {\r\n\t\tthis._controlInformationField = ciField;\r\n\t\tthis._sequenceNumber = this._controlInformationField & 0b00001111;\r\n\t\tthis._lastIsLastSegment = (this._controlInformationField & 0b00010000) == 0b00010000;\r\n\t}\r\n\r\n\tpublic get controlInformationField(): number {\r\n\t\treturn this._controlInformationField;\r\n\t}\r\n\r\n\tpublic get sequenceNumber(): number {\r\n\t\treturn this._sequenceNumber;\r\n\t}\r\n\r\n\tpublic get lastIsLastSegment(): boolean {\r\n\t\treturn this._lastIsLastSegment;\r\n\t}\r\n\r\n\tpublic userData: number[] = [];\r\n\r\n\r\n}\r\n","export const enum TelegramStatus {\r\n\tpending,\r\n\tavailable\r\n}\r\n","import { TelegramStatus } from \"./enums\";\r\nimport { Telegram } from \"./Telegram\";\r\n\r\n// data link layer\r\nexport class TelegramReader {\r\n\r\n\tstatic readonly startByte: number = 0x68;\r\n\tstatic readonly stopByte: number = 0x16;\r\n\r\n\tprivate currentTelegram = new Telegram();\r\n\tprivate possibleStartFound = false;\r\n\r\n\tprivate data: number[] = []\r\n\r\n\tprivate telegrams: Telegram[] = [];\r\n\r\n\r\n\tpublic areTelegramsAvailable(): TelegramStatus {\r\n\t\treturn this.telegrams.length > 0 ? TelegramStatus.available : TelegramStatus.pending;\r\n\t}\r\n\r\n\tprivate resetSearch() {\r\n\t\tthis.possibleStartFound =false;\r\n\t\tthis.currentTelegram = new Telegram();\r\n\t}\r\n\r\n\tpublic addRawData(newData: number[]): TelegramStatus {\r\n\t\t//console.log('addRawData', JSON.stringify(newData));\r\n\t\tif(!this.possibleStartFound) {\r\n\t\t\tconst startByteIndex = newData.indexOf(TelegramReader.startByte);\r\n\t\t\tif(startByteIndex < 0) {\r\n\t\t\t\treturn this.areTelegramsAvailable();\r\n\t\t\t}\r\n\t\t\tthis.possibleStartFound = true;\r\n\t\t\tif(startByteIndex > 0) {\r\n\t\t\t\tnewData = newData.slice(startByteIndex);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.data.push(...newData);\r\n\t\t// console.log('addRawData this.data', JSON.stringify(this.data), this.data.length);\r\n\r\n\r\n\t\treturn this.checkTelegram()\r\n\t}\r\n\r\n\t// only fetch them once!\r\n\tpublic getTelegrams(): Telegram[] {\r\n\t\tconsole.log('getTelegrams this.telegrams.length', this.telegrams.length);\r\n\t\tconst ret = [...this.telegrams];\r\n\t\tconsole.log('getTelegrams ret.length 1', ret.length);\r\n\t\tthis.telegrams = [];\r\n\t\tconsole.log('getTelegrams ret.length 2', ret.length);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tprivate checkTelegram(): TelegramStatus {\r\n\t\tif(this.data.length < 4){\r\n\t\t\treturn this.areTelegramsAvailable();\r\n\t\t}\r\n\r\n\t\tif(this.currentTelegram.dataLen <= 0) {\r\n\t\t\t// check for telegram start sequence\r\n\t\t\tif(this.data[3] != TelegramReader.startByte || this.data[1] != this.data[2]) {\r\n\t\t\t\treturn this.checkForNewStartIndex(1);\r\n\t\t\t}\r\n\t\t\tthis.currentTelegram.dataLen = this.data[1];\r\n\t\t}\r\n\r\n\t\tif(this.currentTelegram.dataLen <= 3) {\r\n\t\t\t// control frame -> ignore\r\n\t\t\treturn this.checkForNewStartIndex(1);\r\n\t\t}\r\n\r\n\t\t// long frame\r\n\r\n\t\tif(this.data.length < this.currentTelegram.totalLen!) {\r\n\t\t\treturn this.areTelegramsAvailable();\r\n\t\t}\r\n\r\n\t\tif(this.data[this.currentTelegram.totalLen - 1] != TelegramReader.stopByte) {\r\n\t\t\treturn this.checkForNewStartIndex(1);\r\n\t\t}\r\n\r\n\t\tconst calculatedChecksum = this.checkChecksum();\r\n\t\tthis.currentTelegram.checkSum = this.data[this.currentTelegram.totalLen! - 2];\r\n\t\tif(calculatedChecksum != this.currentTelegram.checkSum) {\r\n\t\t\tconsole.warn('Invalid checksum', calculatedChecksum, this.currentTelegram.checkSum);\r\n\t\t\treturn this.checkForNewStartIndex(1);\r\n\t\t}\r\n\r\n\t\t// seems like everything is fine - set telegram fields\r\n\t\tthis.currentTelegram.controlField = this.data[4];\r\n\t\tthis.currentTelegram.addressField = this.data[5];\r\n\t\tthis.currentTelegram.controlInformationField = this.data[6];\r\n\r\n\t\tthis.currentTelegram.userData = this.data.slice(6, this.currentTelegram.dataLen - 2);\r\n\r\n\t\t// reset for next telegram\r\n\t\tconsole.log('checkTelegram this.currentTelegram', this.currentTelegram);\r\n\t\tthis.telegrams.push(this.currentTelegram);\r\n\t\tconsole.log('checkTelegram this.telegrams.length', this.telegrams.length);\r\n\t\tconst len = this.currentTelegram.totalLen;\r\n\t\tthis.resetSearch();\r\n\t\tif(this.data.length > len) {\r\n\t\t\tthis.data = this.data.slice(len)\r\n\t\t\t// maybe we have another one:\r\n\t\t\treturn this.checkTelegram()\r\n\t\t}\r\n\r\n\t\tthis.data = [];\r\n\t\t//return this.areTelegramsAvailable()\r\n\t\treturn TelegramStatus.available;\r\n\t}\r\n\r\n\tprivate checkForNewStartIndex(firstPossibleIndex: number): TelegramStatus {\r\n\t\tthis.resetSearch();\r\n\t\tconst newStartByteIndex= this.data.indexOf(TelegramReader.startByte, firstPossibleIndex);\r\n\t\tif(newStartByteIndex < firstPossibleIndex) {\r\n\t\t\tthis.data = [];\r\n\t\t\treturn this.areTelegramsAvailable();\r\n\t\t}\r\n\t\tthis.data = this.data.slice(newStartByteIndex);\r\n\t\tthis.possibleStartFound = true;\r\n\t\treturn this.checkTelegram();\r\n\t}\r\n\r\n\tprivate checkChecksum() {\r\n\t\tconst start = 4;\r\n\t\tconst end = this.currentTelegram.totalLen! - 2;\r\n\t\tlet sum = 0;\r\n\t\tfor(let i = start; i < end; i++) {\r\n\t\t\tsum += this.data[i];\r\n\t\t}\r\n\t\treturn sum & 0xFF;\r\n\t}\r\n}\r\n","module.exports = require(\"serialport\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { SerialPort } from 'serialport';\r\n\r\nimport { Settings } from './utils/interfaces';\r\nimport { SerialPortData } from \"./lib/interfaces\";\r\nimport { TelegramReader } from \"./lib/telegram-reader\";\r\nimport { TelegramStatus } from \"./lib/enums\";\r\n\r\nconst settings: Settings = {\r\n\t// serial port settings\r\n\t//port: '/dev/ttyUSB0'\r\n\tport: '/dev/serial/by-id/usb-Prolific_Technology_Inc._USB-Serial_Controller_DIDSt114J20-if00-port0',\r\n\tbaudRate: 2400,\r\n\tdataBits: 8,\r\n\tparity: 'none',\r\n\tstopBits: 1\r\n\r\n\r\n}\r\n\r\nfunction main() {\r\n\tconst port = new SerialPort({\r\n\t\tpath: settings.port,\r\n\t\tbaudRate: settings.baudRate,\r\n\t\tdataBits: settings.dataBits,\r\n\t\tparity: settings.parity,\r\n\t\tstopBits: settings.stopBits\r\n\t});\r\n\r\n\tconst telegramReader = new TelegramReader();\r\n\r\n\t// Read data that is available but keep the stream in \"paused mode\"\r\n\t// port.on('readable', function () {\r\n\t// \tconsole.log('Data:', port.read())\r\n\t// })\r\n\r\n\t// Switches the port into \"flowing mode\"\r\n\tport.on('data', function (serialPortData: Buffer) {\r\n\t\t//console.log('Data:', serialPortData)\r\n\t\t//console.log('real:', JSON.stringify(serialPortData));\r\n\r\n\t\t// let output = '';\r\n\t\t// for (let property in serialPortData) {\r\n\t\t// \t// @ts-ignore\r\n\t\t// \toutput += property + ': ' + serialPortData[property] + '; ';\r\n\t\t// }\r\n\t\t// console.log(output);\r\n\t\tconsole.log([...serialPortData])\r\n\t\tconst result = telegramReader.addRawData([...serialPortData])\r\n\t\tif(result == TelegramStatus.available) {\r\n\t\t\tconst telegrams = telegramReader.getTelegrams();\r\n\t\t\tconsole.log(JSON.stringify(telegrams))\r\n\t\t}\r\n\t})\r\n\r\n\r\n\t// port.on('open', function() {\r\n\t// \t// open logic\r\n\t// })\r\n\r\n\tport.on('error', function(err) {\r\n\t\tconsole.error('Error: ', err.message)\r\n\t})\r\n}\r\n\r\nmain();\r\n\r\n//Benchmark.bufferArrayBenchmark();\r\n\r\n\r\n\r\n\r\n"],"names":[],"sourceRoot":""}